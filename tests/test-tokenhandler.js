"use strict"
const jwt = require('jsonwebtoken');
const tokenhandler = require(__dirname + '/../src/tokenhandler.js');
const fs = require('fs');
const assert = require('assert');

const key = fs.readFileSync(__dirname + '/test-key.key');
const fakeKey = fs.readFileSync(__dirname + '/fake-test-key.key');
const cert = fs.readFileSync(__dirname + '/test-cert.cert');
const certs = {
  cert: cert,
  key: key
};
const fakeCerts = {
  // we don't really need a cert because we're not testing verify() with this
  key: fakeKey
};
const testID = 'master';

let tokens = new tokenhandler(certs);
let fakeTokens = new tokenhandler(fakeCerts);

let token = tokens.generate(testID);
let fakeToken = fakeTokens.generate(testID);
console.log(token);
describe('authstor', () => {
  describe('#generate(id)', () => {
    it('should generate a valid token', () => {
      assert(token);
    });
  });

  describe('#verify(token)', () => {
    it('should return true if a token was generated by this server', () => {
      assert(tokens.verify(token));
    });
    it('should throw an error if a token was generated by another host', () => {
      assert.throws(tokens.verify(fakeToken), {
        name: 'JsonWebTokenError', message: 'invalid signature'
      });
    });
  });
});
